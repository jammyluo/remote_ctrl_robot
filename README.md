# è¿œç¨‹æ§åˆ¶æœºå™¨äººæœåŠ¡ç«¯

åŸºäºGolangå’ŒJanus WebRTCçš„è¿œç¨‹æ§åˆ¶æœºå™¨äººæœåŠ¡ç«¯ï¼Œæ”¯æŒå¤šæœºå™¨äººç®¡ç†å’Œä½å»¶è¿Ÿæ§åˆ¶ã€‚

## åŠŸèƒ½ç‰¹æ€§

- ğŸ¥ **WebRTCè§†é¢‘æµ**: åŸºäºJanusçš„å®æ—¶è§†é¢‘ä¼ è¾“
- ğŸ¤– **å¤šæœºå™¨äººç®¡ç†**: æ”¯æŒé€šè¿‡UCODEæ ‡è¯†å¤šä¸ªæœºå™¨äºº
- âš¡ **ä½å»¶è¿Ÿæ§åˆ¶**: WebSocketå®æ—¶æ§åˆ¶æŒ‡ä»¤ä¼ è¾“
- ğŸ”’ **å®‰å…¨è®¤è¯**: æœºå™¨äººæ³¨å†Œå’ŒUCODEéªŒè¯
- ğŸ“Š **çŠ¶æ€ç›‘æ§**: å®æ—¶æœºå™¨äººçŠ¶æ€å’Œç³»ç»Ÿç›‘æ§
- ğŸš€ **é«˜æ€§èƒ½**: åŸºäºGolangçš„é«˜å¹¶å‘å¤„ç†

## å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨æœåŠ¡

```bash
# å¯åŠ¨æœåŠ¡å™¨
go run cmd/server/main.go

# æˆ–ä½¿ç”¨Docker
docker-compose up -d
```

### 2. ç§»åŠ¨ç«¯ä½¿ç”¨ï¼ˆiPhone Safariï¼‰

åœ¨iPhone Safariä¸­ä½¿ç”¨æ—¶ï¼Œéœ€è¦æ³¨æ„ä»¥ä¸‹äº‹é¡¹ï¼š

1. **æœåŠ¡å™¨åœ°å€é…ç½®**ï¼š
   - ä¸èƒ½ä½¿ç”¨ `localhost`ï¼Œéœ€è¦ä½¿ç”¨æœåŠ¡å™¨çš„å®é™…IPåœ°å€
   - ä¾‹å¦‚ï¼š`192.168.1.100:8000` æˆ– `your-domain.com`

2. **è¿æ¥æµ‹è¯•**ï¼š
   - ä½¿ç”¨ `tools/test_websocket_connection.html` æµ‹è¯•è¿æ¥
   - ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸

3. **å¸¸è§é—®é¢˜**ï¼š
   - å¦‚æœè¿æ¥å¤±è´¥ï¼Œæ£€æŸ¥é˜²ç«å¢™è®¾ç½®
   - ç¡®ä¿æœåŠ¡å™¨å…è®¸WebSocketè¿æ¥
   - æ£€æŸ¥ç½‘ç»œæ˜¯å¦åœ¨åŒä¸€ç½‘æ®µ

4. **ä½¿ç”¨æ­¥éª¤**ï¼š
   - æ‰“å¼€ `www/mobile_operator.html`
   - ç‚¹å‡»"è®¾ç½®"æŒ‰é’®
   - è¾“å…¥æ­£ç¡®çš„æœåŠ¡å™¨IPåœ°å€
   - è¾“å…¥æœºå™¨äººUCodeå’Œæ“ä½œè€…ID
   - ç‚¹å‡»"ä¿å­˜å¹¶è¿æ¥"

### 2. æœºå™¨äººè¿æ¥

æœºå™¨äººéœ€è¦é€šè¿‡WebSocketè¿æ¥å¹¶æ³¨å†ŒUCODEï¼š

```javascript
// è¿æ¥WebSocket
const ws = new WebSocket('ws://localhost:8080/ws/control');

// è¿æ¥åç«‹å³å‘é€æ³¨å†Œæ¶ˆæ¯
ws.onopen = function() {
    ws.send(JSON.stringify({
        type: "register",
        ucode: "123456"  // æœºå™¨äººå”¯ä¸€æ ‡è¯†
    }));
};
```

### 3. APIä½¿ç”¨

æ‰€æœ‰APIéƒ½éœ€è¦æŒ‡å®šæœºå™¨äººUCODEï¼š

```bash
# è·å–WebRTCæ’­æ”¾åœ°å€
curl "http://localhost:8080/api/v1/webrtc/play-url?ucode=123456"

# å‘é€æ§åˆ¶å‘½ä»¤
curl -X POST "http://localhost:8080/api/v1/control/command?ucode=123456" \
  -H "Content-Type: application/json" \
  -d '{
    "type": "joint_position",
    "command_id": "cmd_001",
    "priority": 5,
    "joint_pos": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
    "velocities": [0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  }'

# è·å–æœºå™¨äººçŠ¶æ€
curl "http://localhost:8080/api/v1/control/status?ucode=123456"
```

## APIæ¥å£

### æœºå™¨äººç›¸å…³æ¥å£ï¼ˆéœ€è¦UCODEï¼‰

#### 1. è·å–WebRTCæ’­æ”¾åœ°å€
```
GET /api/v1/webrtc/play-url?ucode={UCODE}
```

#### 2. å‘é€æ§åˆ¶å‘½ä»¤
```
POST /api/v1/control/command?ucode={UCODE}
Content-Type: application/json

{
  "type": "joint_position|velocity|emergency_stop|home",
  "command_id": "unique_command_id",
  "priority": 1-10,
  "timestamp": 1640995200000,
  "joint_pos": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
  "velocities": [0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
}
```

#### 3. è·å–æœºå™¨äººçŠ¶æ€
```
GET /api/v1/control/status?ucode={UCODE}
```

### ç³»ç»Ÿæ¥å£ï¼ˆæ— éœ€UCODEï¼‰

#### 4. è·å–ç³»ç»ŸçŠ¶æ€
```
GET /api/v1/system/status
```

#### 5. è·å–è¿æ¥çŠ¶æ€
```
GET /api/v1/control/connection
```

#### 6. å¥åº·æ£€æŸ¥
```
GET /health
```

## WebSocketæ¥å£

### æœºå™¨äººæ³¨å†Œ
è¿æ¥åç¬¬ä¸€æ¡æ¶ˆæ¯å¿…é¡»ä¸ºæ³¨å†Œæ¶ˆæ¯ï¼š

```json
{
  "type": "register",
  "ucode": "123456"
}
```

### æ§åˆ¶å‘½ä»¤
```json
{
  "type": "control_command",
  "data": {
    "type": "joint_position",
    "command_id": "cmd_001",
    "priority": 5,
    "joint_pos": [0.1, 0.2, 0.3, 0.4, 0.5, 0.6],
    "velocities": [0.1, 0.1, 0.1, 0.1, 0.1, 0.1]
  }
}
```

## é…ç½®

é…ç½®æ–‡ä»¶ï¼š`config/config.yaml`

```yaml
server:
  port: 8080
  host: "0.0.0.0"
  read_timeout: "30s"
  write_timeout: "30s"

janus:
  websocket_url: "ws://localhost:8188"
  http_url: "http://localhost:8088"
  stream_id: 1

robot:
  websocket_url: "ws://localhost:9090"

logging:
  level: "info"
  format: "json"

security:
  enable_cors: true
  allowed_origins: "*"
```

## æµ‹è¯•

### APIæµ‹è¯•
```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test_api.sh
```

### WebSocketæµ‹è¯•
æ‰“å¼€ `test_client.html` è¿›è¡ŒWebSocketè¿æ¥æµ‹è¯•ã€‚

## éƒ¨ç½²

### Dockeréƒ¨ç½²
```bash
# æ„å»ºé•œåƒ
docker build -t remote-ctrl-robot .

# è¿è¡Œå®¹å™¨
docker run -p 8080:8080 remote-ctrl-robot
```

### ç”Ÿäº§ç¯å¢ƒ
1. é…ç½®HTTPSè¯ä¹¦
2. è®¾ç½®é˜²ç«å¢™è§„åˆ™
3. é…ç½®è´Ÿè½½å‡è¡¡
4. ç›‘æ§å’Œæ—¥å¿—æ”¶é›†

## æ¶æ„è¯´æ˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å®¢æˆ·ç«¯/æµè§ˆå™¨   â”‚    â”‚   æ§åˆ¶æœåŠ¡å™¨     â”‚    â”‚   æœºå™¨äººè®¾å¤‡     â”‚
â”‚                 â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚WebRTCæ’­æ”¾å™¨  â”‚â—„â”€â”€â”€â”€â”¤ â”‚Janus WebRTC â”‚ â”‚    â”‚ â”‚WebSocket    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚è§†é¢‘æœåŠ¡å™¨    â”‚ â”‚    â”‚ â”‚å®¢æˆ·ç«¯       â”‚ â”‚
â”‚                 â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚                 â”‚    â”‚                 â”‚
â”‚ â”‚WebSocket    â”‚â—„â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚    â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚æ§åˆ¶å®¢æˆ·ç«¯    â”‚ â”‚    â”‚ â”‚Golang API   â”‚ â”‚    â”‚ â”‚æœºå™¨äººæ§åˆ¶å™¨  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â”‚ â”‚æœåŠ¡å™¨       â”‚ â”‚    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ³¨æ„äº‹é¡¹

1. **UCODEç®¡ç†**: æ¯ä¸ªæœºå™¨äººå¿…é¡»æœ‰å”¯ä¸€çš„UCODE
2. **è¿æ¥é¡ºåº**: æœºå™¨äººå¿…é¡»å…ˆè¿æ¥WebSocketå¹¶æ³¨å†ŒUCODE
3. **é”™è¯¯å¤„ç†**: APIä¼šè¿”å›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
4. **æ€§èƒ½ä¼˜åŒ–**: æ”¯æŒå¤šæœºå™¨äººå¹¶å‘æ§åˆ¶
5. **å®‰å…¨è€ƒè™‘**: ç”Ÿäº§ç¯å¢ƒåº”æ·»åŠ UCODEç™½åå•éªŒè¯

## å¼€å‘

### é¡¹ç›®ç»“æ„
```
remote_ctrl_robot/
â”œâ”€â”€ cmd/server/          # ä¸»ç¨‹åºå…¥å£
â”œâ”€â”€ internal/            # å†…éƒ¨åŒ…
â”‚   â”œâ”€â”€ handlers/        # HTTPå’ŒWebSocketå¤„ç†å™¨
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹
â”‚   â””â”€â”€ services/        # ä¸šåŠ¡é€»è¾‘æœåŠ¡
â”œâ”€â”€ config/              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ test_client.html     # æµ‹è¯•å®¢æˆ·ç«¯
â””â”€â”€ test_api.sh         # APIæµ‹è¯•è„šæœ¬
```

### æ·»åŠ æ–°åŠŸèƒ½
1. åœ¨ `internal/models/` ä¸­å®šä¹‰æ•°æ®ç»“æ„
2. åœ¨ `internal/services/` ä¸­å®ç°ä¸šåŠ¡é€»è¾‘
3. åœ¨ `internal/handlers/` ä¸­æ·»åŠ APIæ¥å£
4. æ›´æ–°æµ‹è¯•è„šæœ¬å’Œæ–‡æ¡£

## è®¸å¯è¯

MIT License 